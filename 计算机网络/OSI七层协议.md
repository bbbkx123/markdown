## 什么是OSI七层协议

互联网的本质就是**一系列的网络协议**，这个协议就叫OSI七层协议（一系列协议）

![](/Users/wangyufei/Web-Project/Mine/markdown/计算机网络/图片/网络七层协议.png)



## 物理层

字面意思解释：物理传输、硬件、物理特性。中间的物理链接可以是**光缆、电缆、双绞线、无线电波**。中间传的是电信号，即010101...这些二进制位。



## 数据链路层

物理层传输二进制数据，数据链路层将010010101001...将数据进行分组（发送及接收都按照8位一组来划分），让数据有意义

**早期的时候，数据链路层就是来对电信号来做分组的**，后来形成了统一的标准（标准就是协议），即```以太网协议Ethernet```。

### Ethernet规定

一组电信号称之为一个**数据包**，或者叫做一个**“帧”**

* 数据帧分成：报头head和数据data两部分


head包含：（固定18个字节）

* 发送者（源地址，6个字节）
* 接收者（目标地址，6个字节）
* 数据类型（6个字节）

data包含：（最短46字节，最长1500字节）

* 数据包的具体内容

### MAC地址

head中包含的源和目标地址由来：Ethernet规定接入Internet的设备都必须具备网卡，发送端的和接收端的地址便是指网卡的地址，即Mac地址。

有了mac地址以后，计算机就可以通信了，假设**一个教室就是一个局域网**（隔离的网络），这个教室里面有几台计算机，计算机的通信和人的通信是一个道理，把教室里面的人都比作一个个计算机，假设教室里面的人都是瞎子，其实计算机就是瞎子的，计算机通信基本靠吼，现在我要找教室里面的飞哥要战狼2的片，然后我就吼一声，说我要找飞哥要战狼2的片，战狼2的片就属于我的数据，但是我在发的时候我是不是要标识我是谁，我要找谁，我是谁就是我的**mac**地址，我要找谁就是飞哥的**mac**地址，这两个地址做数据包的头部，再加上数据战狼2的片就构成了一个数据帧。





这个**数据包封装好以后就往外发**，到物理层以后就全部转成二级制，往外发是怎么发的呢？就是靠吼。即“我是Edison，我找飞哥要战狼2的片”。这么吼了一嗓子以后，全屋子的人都能听到，这就是**广播**。

**计算机底层，只要在一个教室里（一个局域网），都是靠广播的方式，吼。**

**局域网的理解：什么是互联网，互联网就是由一个个局域网组成，局域网内的计算机不管是对内还是对外都是靠吼，这就是数据链路层的工作方式-----广播。**



广播出去以后，所有人都听得见，所有人都会拆开这个包，读发送者是谁，接收者是谁，**只要接收者不是自己就丢弃掉**。对计算机来说，它会看自己的Mac地址，飞哥收到以后，他就会把片发给我，发送回来同样采用广播的方式了，靠吼。

同一个教室（同一个局域网）的计算机靠吼来通信，那不同教室的计算机又如何？

比如说局域网1的pc1与局域网2的pc10如何通信？你在教室1（局域网1）吼，教室2（局域网2）的人肯定是听不见的。这就是跨网络进行通信，数据链路层就解决不了这个问题了，这就得靠网络层出面了。

![](/Users/wangyufei/Web-Project/Mine/markdown/计算机网络/图片/局域网和互联网.png)



## 网络层

网络层定义了一个IP协议

### Mac地址和IP地址

**Mac地址**是用来标识你这个教室的某个位置，**IP地址**是用来标识你在哪个教室（哪个局域网）。计算机在发包前，会判断你在哪个教室，对方在哪个教室，如果在一个教室，基于mac地址的广播发包就OK了；如果不在一个教室，即跨网络发包，那么就会把你的包交给教室负责人**（网关）**来转发。Mac地址及IP地址唯一标识了你在互联网中的位置。

### 数据包装

**数据链路层中会把  网络层的数据包  封装到数数据链路层的数据位置**，然后再添加上自己的包头，再发给物理层，物理层发给网关，网关再发给对方教室的网关，对方教室的网关收到后在那个教室做广播。

![](/Users/wangyufei/Web-Project/Mine/markdown/计算机网络/图片/数据链路层-跨网发包.png)

### 获取目标Mac地址

>  通过ARP协议

#### 局域网中怎么获取对方的Mac地址

![](/Users/wangyufei/Web-Project/Mine/markdown/计算机网络/图片/ARP协议广播包.png)

Mac为12个F代表的是一种功能，这个功能就是获取对方的MAC地址，计算机的Mac永远不可能是12个F。

假设是在本教室广播，一嗓子吼出去了，所有人开始解包，只有IP地址是172.16.10.11的这个人才会返回他的Mac地址，其他人全部丢弃。发回来源Mac改成飞哥自己的Mac地址，同时把飞哥的Mac地址放在数据部分。

#### 跨网络怎么获取对方的Mac地址

<img src="/Users/wangyufei/Web-Project/Mine/markdown/计算机网络/图片/跨网获取Mac地址.png" alt="image-20210412151708373" style="zoom:50%;" />

网关帮你去找飞哥，但对用户来说，我们根本就感觉不到网关的存在



## 传输层

传输层的由来：网络层的ip帮我们区分子网，以太网层的mac帮我们找到主机，然后大家使用的都是应用程序，你的电脑上可能同时开启qq，暴风影音，等多个应用程序，

那么我们通过ip和mac找到了一台特定的主机，如何标识这台主机上的应用程序，答案就是端口，**端口即应用程序与网卡关联的编号。**

传输层功能：建立端口到端口的通信

补充：端口范围0-65535，0-1023为系统占用端口

tcp协议：

可靠传输，TCP数据包没有长度限制，理论上可以无限长，但是为了保证网络的效率，通常TCP数据包的长度不会超过IP数据包的长度，以确保单个TCP数据包不必再分割。

| 以太网头 | ip 头 | tcp头 | 数据 |
| -------- | ----- | ----- | ---- |
|          |       |       |      |

​                                                    


udp协议：

不可靠传输，”报头”部分一共只有8个字节，总长度不超过65,535字节，正好放进一个IP数据包。

| 以太网头 | ip头 | udp头 | 数据 |
| -------- | ---- | ----- | ---- |
|          |      |       |      |

​              

## 应用层

应用层由来：用户使用的都是应用程序，均工作于应用层，互联网是开发的，大家都可以开发自己的应用程序，数据多种多样，必须规定好数据的组织形式 。

应用层功能：规定应用程序的数据格式。

例：TCP协议可以为各种各样的程序传递数据，比如Email、WWW、FTP等等。那么，必须有不同协议规定电子邮件、网页、FTP数据的格式，这些应用程序协议就构成了”应用层”。


