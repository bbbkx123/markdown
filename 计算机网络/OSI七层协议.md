https://juejin.cn/post/6844904079974465544#heading-29

## 什么是OSI七层协议

互联网的本质就是**一系列的网络协议**，这个协议就叫OSI七层协议（一系列协议）

![网络七层协议.png](https://note.youdao.com/yws/res/18533/WEBRESOURCE8a18d4f729a2d07bd0f659c85b6d1be6)

## 物理层

字面意思解释：物理传输、硬件、物理特性。中间的物理链接可以是**光缆、电缆、双绞线、无线电波。中间传的是电信号，即010101...这些二进制位。**

**双绞线** ： 两根绝缘铜导线按照一定密度绞在一起，每一根导线在传输中辐射出来的电波会被另一根线上发出的电波抵消，有效降低信号干扰的程度。



## 数据链路层

### 数据链路层的主要功能

```(1) 封装成帧```

数据链路层将数据进行封装。封装的网络数据包，在链路层就叫```数据帧```。

![image.png](https://note.youdao.com/yws/res/18531/WEBRESOURCE6135a24ee8e22ebee89946cb57e7848a)

```(2) 透明传输```

帧的数据部分可能有==跟帧首部完全一样的字符==，这时候就要采取一定的措施，让接受方不要被被误导，能让接收方知道哪些是帧的首部哪些是帧的数据。这个问题有没有类似js的转义字符的问题，比如字符串```<div>```到底是指div标签呢，还是div字符串呢

```(3) 差错控制```
链路层的帧，会有一个FCS位留给这个码，用来判断一个帧是否出错


```(4) 差错纠正```

==能通过重新发送没有的数据来纠正==。

```(5) 流量控制``` 

比如说发送方**发送速度特别快**，接收方**接收速度特别慢**，会造成传输出错。

###  以太网的帧格式

![image.png](https://note.youdao.com/yws/res/18529/WEBRESOURCE3c03bba67079c04742d88915b203678f)

* 其中目的地址和源地址指的是==MAC地址==，即设备的==物理地址==。MAC地址用于标示网卡，每个网卡都具有唯一的MAC 地址。
* 当在同一个局域网中，主机A需要给主机B发送消息时，主机A将==以太网帧发出==，此时局域网中所有主机均可收到这个桢，主机中的网卡接收到以太网桢后，==会将目的MAC地址和自己的MAC地址进行比较,如果不相同就会丢弃，如果相同则会接收==，此时则B主机就收到了A的消息。
* 其最后面是CRC循环冗余码，用于==差错控制==，即检验帧的正确性。
* 在以太网协议中，目的地址分为三种==单播地址==、==广播地址==、==多播地址==，其中单播地址如上面A给B主机发送，其接收者为一个，并且其目的地址的最高字节的低位为0。

### 以太网的特点
无连接。发送方和接收方不建立连接。  
不可靠。接收方不向发送方进行确认，差错帧直接丢弃。

**数据包封装好以后就往外发**，到物理层以后就全部转成二进制，通过**广播**向外发送。

**在计算机底层，一个局域网类似于一个教室，都是靠广播的方式(吼)发送。**

**局域网的理解：什么是互联网，互联网就是由一个个局域网组成，局域网内的计算机不管是对内还是对外都是靠吼，这就是数据链路层的工作方式-----广播。**

==不同局域网==进行通信，数据链路层就解决不了这个问题了，这就得靠网络层出面了。

![局域网和互联网.png](https://note.youdao.com/yws/res/18527/WEBRESOURCE8a89d09f7f292723b4896564c502b321)


## 网络层

网络层的目的是实现两个端系统之间(主机到主机)的数据透明传送，具体功能包括==寻址和路由选择、连接的建立、保持和终止==等。它提供的服务使传输层不需要了解网络中的数据传输和交换技术。

### 分组交换
当主机H1要向另一主机H2发送数据（报文）时，==首先将数据划分成若干个等长的分组==，然后将这些分组一个接一个地发往里与H1相联的路由A ,当A接到分组后，先放入缓冲区，再按一定的路由算法确定该分组下一步将发注哪个结点，如此一个结点一个结点传递，==直到最终目的H2==。

### 数据报
数据报是通过网络传输的数据的基本单元，包含一个**报头**（header）和**数据本身**。

### ip地址分类

* A类：1.0.0.0~126.255.255.255
* B类：128.0.0.0~191.255.255.255
* C类：192.0.0.0~223.255.255.255
* D类：224.0.0.0~239.255.255.255
* E类：240.0.0.0~254.255.255.255  
其中127.0.0.0~127.255.255.255用于环回测试，D类地址用于组播，E类地址用于科研

其实是因为有一部分叫私有IP地址，是不能拿到网络上跟别的计算机通信的。只能是局域网自己内部用

### 数据包装

**数据链路层中会把  网络层的数据包  封装到数数据链路层的数据位置**，然后再添加上自己的包头，再发给物理层，物理层发给网关，网关再发给对方教室的网关，对方教室的网关收到后在那个教室做广播。

![数据链路层-跨网发包.png](https://note.youdao.com/yws/res/c/WEBRESOURCEda3f1753f49ce3d1f16b5e3f2dc460ac)

### 几种协议

>  ARP

获取对方的Mac地址

> DHCP(动态主机配置协议)

是一个局域网的网络协议。客户机登录服务器时就可以自动获得服务器分配的lP地址和子网掩码。

> ICMP

* 确认IP包是否成功到达目标地址
* 通知在发送过程中IP包被丢弃的原因


我们常用的ping命令借助ICMP协议，探测主机是否能找到目的主机。

## 传输层

传输层是只有计算机才有的层次，主要提供是进程间==逻辑通信== + ==可靠传输==或者==不可靠==的功能。

传输层功能：建立端口到端口的通信(不同的计算机，进程间的通信)

### 端口

端口号可以用来标识同一个主机上通信的不同应用程序（就是哪个应用程序在使用这个端口）

补充：端口范围0-65535，0-1023为系统占用端口

### TCP协议(传输控制协议)

> 三次握手

![image.png](https://note.youdao.com/yws/res/18566/WEBRESOURCEb68033f14d6b73172d9f475e1f556fdd)


> 四次挥手

![image.png](https://note.youdao.com/yws/res/18535/WEBRESOURCEc4bceccee6d3efe02d11bfc3caa7f256)


#### TCP3次握手4次挥手常见面试题

> 为什么连接的时候是三次握手，关闭的时候却是四次握手？


==关闭连接时，服务器收到对方的FIN报文时，仅仅表示对方不再发送数据了但是还能接收数据，而自己也未必全部数据都发送给对方了，所以己方可以立即关闭，也可以发送一些数据给对方后，再发送FIN报文给对方来表示同意现在关闭连接
因此，己方ACK和FIN一般都会分开发送，从而导致多了一次==。

> 为什么不能用两次握手进行连接？

1. 第一次握手（client到server），server可以判断client具有==发送能力==
2. 第二次握手（server到client），client可以判断server具有==发送能力==和==接收能力==
3. 第三次握手（client到server），server可以判断client具有==接收能力==



### udp协议(用户数据报协议)

UDP协议是参考模型中一种无连接的传输层协议，提供面向事务的简单不可靠信息传送服务。

```(1) udp协议特点```

* UDP是==无连接==的，减少开销和发送数据之前的时间延迟。大家都知道TCP的三次握手和四次分手，这个是需要时间花销的，但是UDP没有这部分花销。


* UDP使用==最大努力交付==，即不保证可靠交付。那谁来保证可靠的交付呢？是由UDP的上一层协议，应用层来保证。


* UDP是==面向报文==的，适合一次性传输少量数据的网络应用。什么意思呢，如下图，UDP这层，把应用层的全部内容作为自己的数据报部分，在IP层也只是加了一个IP首部，我们知道，在以太网，链路层上的数据如果超过1500字节，就会分片，所以网络层发现上面传输层给了==太大的数据就会分片==，加上UDP是不可靠的协议，这就加大了UDP的不可靠性，容易丢失，所以UDP适合==数据量少==的。

* UDP没有拥塞控制，适合很多实时应用。也就是说如果网络堵塞，UDP不管那么多，照样按照自己的速率发数据，那有些人就会说，这协议是不是有点坑B，路都堵上了，还发死劲发数据呢，但是反过来看，这也是UDP的优点，它==允许丢包==，如果你的网络情况还不错，==UDP就非常适合实时应用，比如视频会议==。


* UDP首部较小，只有8字节，而TCP由20字节。这也是==减少网络传输开销==的一方面


![image.png](https://note.youdao.com/yws/res/18536/WEBRESOURCEcdcc86881512891af46f48103955653e)
              

## 应用层


### 应用层有啥用？

应用层对应用程序的通信提供服务。

* 区分是发送报文还是接收报文
* 定义报文类型的语法，比如某字段的意思，例如http中content-type字段是什么意思。
* 最后就是进程如何，什么时候把传输层的数据交给应用层。

### 一些重要的应用层协议

* FTP：文件传输协议，用来在客户机和FTP服务器之间传输文件。
* DNS: 域名系统, 提供域名到IP地址之间的解析服务。
* SMTP：简单邮件传输协议，用户通过SMTP服务器发送邮件。
* DHCP：动态主机配置协议，DHCP服务器为客户机动态分配IP地址。
* POP3：邮件接收协议，用于从POP3服务器接收邮件。
* HTTP: 超文本传输协议, www服务器和浏览器之间信息传递规范。